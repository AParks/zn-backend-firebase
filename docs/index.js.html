<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

var znFirebase = require('../../../lib/zn-firebase');
var Q = require('q');

/**
 * Expand a generic Firebase path and return a reference to it.
 *
 * @param {string} path
 *
 * @returns {Firebase} A Firebase reference.
 */
module.exports.expandPath = function (path) {
	var ref = znFirebase();

	if (Array.isArray(path) &amp;&amp; path.length) {
		ref = ref.child(path.join('/'));
	} else if (path) {
		ref = ref.child(path);
	}

	return ref;
};

/**
 * Helper to load data from Firebase.
 *
 * @param {Array&lt;string>|string} path A string or an array of path components that will be concatenated with '/' as the separator.
 * 	Ex: ['foo', 'bar', 'baz'] will become 'foo/bar/baz'
 *
 * @return {Promise&lt;Object>}
 *
 * @see expandPath
 */
module.exports.load = function (path) {
	var def = Q.defer();

	module.exports.expandPath(path).once('value', function (snapshot) {
		def.resolve(snapshot.val());
	}, function (err) {
		def.reject(err);
	});

	return def.promise;
};

/**
 * Helper to save arbitrary data to Firebase.
 *
 * @param {Array&lt;string>} path An array of path components that will be concatenated with '/' as the separator.
 * 	Ex: ['foo', 'bar', 'baz'] will become 'foo/bar/baz'
 * @param {Object} data
 *
 * @return {Promise}
 *
 * @see expandPath
 */
module.exports.save = function (path, data) {
	var def = Q.defer();

	module.exports.expandPath(path).update(data, function (err) {
		if (err) {
			def.reject(err);
		} else {
			def.resolve();
		}
	});

	return def.promise;
};

/**
 * @callback updateFunction A developer-supplied function which will be passed the current data stored at this location (as a JavaScript object). The function should return the new value it would like written (as a JavaScript object). If undefined is returned (i.e. you return with no arguments) the transaction will be aborted and the data at this location will not be modified.
 * @param {string|number|boolean|null} value initial value in Firebase
 * @returns {string|number|boolean|void} updated value
 */

/**
 * Atomically modifies and then returns the data at this location. Full firebase documentation:
 * https://www.firebase.com/docs/web/api/firebase/transaction.html
 *
 * @param {Array&lt;string>} path An array of path components that will be concatenated with '/' as the separator.
 * 	Ex: ['foo', 'bar', 'baz'] will become 'foo/bar/baz'
 * @param {updateFunction} updateFunction A developer-supplied function which will be passed the current data stored at this location (as a JavaScript object). The function should return the new value it would like written (as a JavaScript object). If undefined is returned (i.e. you return with no arguments) the transaction will be aborted and the data at this location will not be modified.
 * @param {boolean} applyLocally By default, events are raised each time the transaction update function runs. So if it is run multiple times, you may see intermediate states. You can set this to false to suppress these intermediate states and instead wait until the transaction has completed before events are raised.
 *
 * @return {Promise&lt;string|number|boolean>} Value from the onComplete Function
 *
 * @see expandPath
 */
module.exports.transaction = function (path, updateFunction, applyLocally) {
	var def = Q.defer();
	var ref = module.exports.expandPath(path);

	ref.transaction(updateFunction, function (err, committed, snapshot) {
		if (err || !committed) {
			def.reject(err || 'update function return undefined; value not saved');
		} else {
			def.resolve(snapshot.val());
		}
	}, applyLocally);

	return def.promise;
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#expandPath">expandPath</a></li><li><a href="global.html#load">load</a></li><li><a href="global.html#save">save</a></li><li><a href="global.html#transaction">transaction</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Wed Nov 28 2018 16:57:53 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
